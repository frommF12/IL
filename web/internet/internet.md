
## 인터넷 동작 원리

### 광섬유 네트워크 

    
  우리가 유튜브영상을 보려고 할 때 어떤 동작이 수행될까?


  일단 유튜브영상은 구글 데이터 센터의 수천, 수만개의 서버중 하나의 ssd에 저장되어있다.


  영상이 우리에게 도달하는데 광섬유 네트워크를 이용하는데 이것을 알기 전에 IP를 알아야한다. (셀룰러 데이터나 와이파이도 궁극적으로 광섬유 케이블 네트워크에 연결된다.)


  IP주소는 네트워크를 이용하는 하나의 장치(스마트폰, 공유기, 컴퓨터 등)의 주소이다. 
  택배를 받을 때 이용되는 집 주소처럼 IP주소도 모든 정보를 받을 때 사용된다. 
  IP주소는 고유한 값이며 32비트의 크기를 가진다. 8비트씩 끊어서 옥텟(octets)이라고 하고 각 옥텟은 0 ~ 255의 값을 가지며 (2의 8승)  10진수로 바꾸어 표기한다. (192.168.0.1)
  IP주소는 네트워크ID  + 호스트 ID로 구성되고 이렇게 그룹화된 것을 class라고 부르며 
  class는 A,B,C,D,E로 나뉜다.
  A class : 1.0.0.0 ~ 126.255.255.255
  B class : 128.0.0.0 ~ 191.255.255.255
  C class : 192.0.0.0 ~ 223.255.255.255

  ISP 공급자가 IP주소를 지정한다. 


  데이터센터의 서버에도 IP주소가 있다.  서버를 웹사이트에 저장하므로 서버의 IP주소를 알면 웹사이트에 접속할 수 있다.


  그러나 IP주소를 숫자로 되어있어 기억하기 어렵기 때문에 숫자 대신에 도메인 이름이 사용된다.


  서버는 여러 개의 웹사이트를 저장할 수 있는데 만약 여러 개의 웹사이트를 가진 서버라면
  서버의 IP주소로 모든 웹사이트에 접속할 수 없다


  이러한 경우 웹사이트를 고유하게 식별하기 위해 포스트헤더를 사용한다. 
  (유튜브나 페이스북같이 큰 웹사이트의 경우 전체 데이터센터의 인프라가 특정 웹사이트의 저장공간으로 사용된다.)


  도메인 이름을 입력했을 때 인터넷은 DNS를 이용해 IP주소를 찾는다.
  (DNS는 전화번호부같은 느낌 / ISP공급자가 관리한다.)


  IP주소 부여, 도메인 이름등록 등과 같은 인터넷 관련 작업들을 ICANN이라는 조직에서 수행한다. (INTERNET CORPORATION FOR ASSIGNED NAMES AND NUMBERS 미국에 있음)  
  
---

  ### 지금까지의 내용 정리

  우리가 브라우저 주소 표시줄에 도메인을 입력하면 

  브라우저가 해당 IP주소를 얻기 위해서 DNS서버에 요청을 보냄

  IP주소를 얻은 후에 해당 요청을 데이터 센터의 서버로 전달한다.

  서버가 특정 웹사이트의 접속 요청을 받으면 전달할 데이터는 광섬유 케이블을 통해
  디지털 형식으로 전송된다. (정확히는 광 펄스의 형태로 전송된다.)

  데이터는 수천마일을 이동하는데 산이나 바다 밑과 같은 험한 지형을 지나간다.

  이런 광케이블을 구축하고 유지하는(잠수함 케이블) 글로벌 기업들이 있다. (AT&T, verizon, google)


  해저 밑을 열심히 달려와서 집에 있는 라우터에 데이터를 전달한 하면 라우터는 빛 신호를 전기신호로 변환한 후 이더넷 케이블을 사용하여 컴퓨터(유선 네트워크)에 전기신호를 전송한다. 


  셀룰러 데이터(무선 네트워크)를 사용하는 경우에는 광 케이블의 신호는 기지국으로 전송되고 기지국은 전자파형태로 우리의 스마트폰에 전달한다.
  
 ---

### 패킷과 프로토콜


  구글 데이터센터로부터 받아서 보고 있는 유튜브영상은  0,1의 수많은 모임의 형태로 전달되어진다. 


  수많은 0과 1은 서버에 의해 0과 1이 패킷으로 구분되어 작은 덩어리 형태로 전송된다.


  각 패킷은 영상의 비트, 서버 및 휴대폰의 ip 주소와 시퀀스번호로 구성된다. 


  이 정보들을 활용해서 패킷이 휴대폰을 향해 라우팅된다. 라우팅은 어느 경로던 상관없다.
  (최상의 경로를 사용한다.)

  패킷이 휴대폰에 도달하면 시퀀스 번호에 따라 다시 조립된다. 패킷이 휴대폰에 도달하지 않게 되면 손실된 패킷을 다시 전송하게끔하는 확인 메세지가 휴대폰에 뜬다. 


  집 우편을 보내는데 주소 번호가 없다는 지, 상세 주소가 안적혀있는 문제들이 발생할 수 있으므로 작성 규칙이 있듯이


  인터넷에서도 데이터 패킷의 흐름을 관리하기 위해 프로토콜을 사용한다. 


  프로토콜은 데이터 패킷 변환, 각 패킷에 대한 발신처 및 수신처 주소 첨부,  라우터의 규칙등에 대한 규칙들을 설정한다.  응용프로그램마다 사용되는 프로토콜이 다르다. 
  
--- 

### 포트


  하나의 서버가 있을 때 이 서버는 다양한 역할을 한다.


  웹 사이트를 전달해주거나 파일을 요청하거나 등등


  이럴 경우 클라이언트가 서버에게 요청을 보냈을 때 어떤 요청인지 파악하기 위해서 포트를 사용한다.


  즉 논리적으로 서버를 나누어 요청을 구분해서 실행할 수 있게끔 해주는 것이 포트이다.

  포트는 숫자로 표현되며 65535번까지 있다.


  - 0 ~ 1023번 : 잘 알려진 포트
  - 1024 ~ 49151번 : 등록된 포트
  - 49152 ~ 65535번 : 동적 포트


  20번 : FTP
  21번  : FTP(제어)
  22번 : SSH
  53번 : DNS
  80번 : 월드 와이드 웹 (http) 
  
--- 

### 공유기 


  과거에는 집에 컴퓨터가 한대만 있었기 때문에 모뎀만 있으면 인터넷을 설치해서 연결할 수 있었지만 요즘은 스마트폰을 각자 갖고 있고 컴퓨터가 여러 대인 경우도 많다.


  그래서 공유기를 사용을 하는데 단순히 인터넷을 할 때는 상관없지만 내가 어떤 서비스나 서버를 구축한다면 공유기와 포트 포워딩에 대해서 이해해야 한다.


  위에 IP주소에 대해서 말했듯이 32비트로 구성된 IP주소는 약 42억개의 주소만 할당할 수 있어서 많이 부족하다.


  그렇기 때문에 전세계적으로 네트워크가 필요하지 않는 장비에 대해서는 별도의 사설 네트워크를 구축해서 사용한다.


  인터넷이 가능한 IP가 공인 아이피는 사용하는 기기 하나에 고유한 값이 지정된다.


  그런데 10.0.0.1~ 10.255.255.254 ,172.16.0.1 ~ 172.31.255.254 , 192.168.0.1 ~ 192.168.255.254
  아이피 대역은 회사나 개인이 별도로 구축할 사설 네트워크에서만 사용된다.


  본래 사설 네트워크를 구축하기 위해서 DHCP 서버와 라우터가 필요하지만 이러한 기능이 하나로 뭉쳐져 있는게 바로 공유기이다.


  공유기의 역할은 공유기에 연결되어 있는 모든 기기들에 사설 네트워크를 구축해주는 것이다. 


  사설 네트워크이기 때문에 사설 아이피 대역을 사용하며 주로 사용되는 아이피 대역이 192.168.x.x이다


  192.168로 시작하는 아이피를 가진 장비는 인터넷에 접속하기 위해서 공인 아이피를 보유한 장비가 반드시 필요하다.


  공유기는 사설 네트워크를 구축하면서 동시에 공인 아이피를 하나 할당 받는다.


  그래서 공유기에 연결된 모든 장비들은 인터넷에 접근하기 위해서 공유기를 거쳐야만 한다.


### 포트 포워딩


  사설 아이피를 사용한다면 여러군데서 사용하기 때문에 특정 컴퓨터를 가르킬 수가 없다.


  그래서 사설 아이피를 알려주는게 아니라 공유기가 가진 공인 아이피를 알려준다.


  위의 사진에서 컴퓨터 1이 웹서버를 80번 포트로 열었을 때 공인 아이피의 80번 포트로 들어오는 연결은 공유기에서 멈춘다.


  공유기는 연결된 컴퓨터중에서 어느 컴퓨터로 전달해야되는지 모르기 때문에 공인 아이피의 80번 포트로 들어오는 연결을 컴퓨터 1의 80번 포트로 연결하라고 공유기에 설정해야 한다.


  이것을 포트 포워딩이라고 한다.

  포트 포워딩을 할 때 다음과 같은 사항을 참고해야 한다.

  1. 외부 포트와 내부 포트 번호가 다를 수 있다.  (80을 8080으로 포워딩 가능)
  2. 내부에서 연결하려는 포트는 반드시 아이피 지정을 해줘야 한다.
  3. 하나의 포트로 들어오는 연결을 두 아이피 이상으로 포워딩을 할 수 없다. 
      (운영 및 보안에 심각한 문제 초래)
  4. 공유기가 할당 가능한 아이피에만 포워딩이 가능하다.  
 
--- 

참고 자료  
https://www.youtube.com/watch?v=o5yBl59wRbY&ab_channel=Lesics%ED%95%9C%EA%B5%AD%EC%96%B4  
https://lamanus.kr/59
